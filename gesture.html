<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sign Language App - Gesture Recognition</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      background-color: #f0f8ff;
      height: 100%;
    }

    .container {
    max-width: 400px;
    margin: 0 auto;
    background-color: rgb(255, 255, 255);
    display: flex;
    flex-direction: column;
    padding-bottom: 60px; /* add this line */
    box-sizing: border-box;
    }


    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      border-bottom: 1px solid #ddd;
    }

    .header h2 {
      margin: 0;
      font-size: 18px;
    }

    .content {
      flex-grow: 1;
      padding: 20px;
      display: flex;
      flex-direction: column;
    }

    .video-container {
      background-color: #e0e0e0;
      border-radius: 10px;
      overflow: hidden;
      position: relative;
      width: 100%;
      aspect-ratio: 4 / 3;
      margin-bottom: 10px;
    }

    #camera-feed, #hand-canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    #hand-canvas {
      z-index: 1;
      pointer-events: none;
    }

    .translation-box {
      background-color: #f0f0f0;
      border-radius: 10px;
      padding: 20px;
      text-align: center;
      margin-bottom: 20px;
    }

    .controls {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    .control-item {
      background-color: #e0e0e0;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    .control-item h3 {
      margin: 5px 0;
      font-size: 14px;
    }

    .footer {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background-color: white;
    display: flex;
    justify-content: space-around;
    align-items: center;
    padding: 10px 0;
    border-top: 1px solid #ddd;
    z-index: 1000;
}


    .footer a {
      text-decoration: none;
      color: #888;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .footer a img {
      width: 24px;
      height: 24px;
      margin-bottom: 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <img src="images/deafy logo.png" style="width: 30px; height: 30px;" />
      <h2>Gesture Recognition</h2>
      <h2></h2>
    </div>

    <div class="content">
      <div class="video-container">
        <video id="camera-feed" autoplay playsinline muted></video>
        <canvas id="hand-canvas"></canvas>
      </div>

      <div class="translation-box" id="translation-output">Translation</div>

      <div class="controls">
        <div class="control-item">
          <a href="gesture2.html" style="text-decoration: none; color: black;">
            <img src="images/swap.png" alt="Change Mode" style="width: 30px; height: 30px;" />
            <h3>Change Mode</h3>
            <p>Text to sign language</p>
          </a>
        </div>
        <div class="control-item">
          <a href="offline.html" style="text-decoration: none; color: black;">
            <img src="images/language.png" alt="Change Language" style="width: 30px; height: 30px;" />
            <h3>Language Options</h3>
            <p>Switch between different sign languages</p>
          </a>
        </div>
      </div>
    </div>

    <div class="footer">
      <a href="home.html"><img src="images/home.png" alt="Home" />Home</a>
      <a href="courses.html"><img src="images/to-do-list.png" alt="Courses" />Courses</a>
      <a href="profile.html"><img src="images/user.png" alt="Profile" />Profile</a>
    </div>
  </div>

  <!-- MediaPipe Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>

  <script>
    const videoElement = document.getElementById('camera-feed');
    const canvasElement = document.getElementById('hand-canvas');
    const canvasCtx = canvasElement.getContext('2d');
    const translationOutput = document.getElementById('translation-output');
    
    // Function to detect specific gestures based on hand landmarks
    function detectGesture(landmarks) {
      if (!landmarks || landmarks.length === 0) return null;

      const thumb = landmarks[4];
      const index = landmarks[8];
      const middle = landmarks[12];
      const ring = landmarks[16];
      const pinky = landmarks[20];

      // Detecting peace sign (index and middle fingers up, others down)
      if (index.y < middle.y && middle.y < ring.y && ring.y < pinky.y && thumb.y > index.y) {
        return "peace";
      }

      // Detecting thumbs up (thumb up, fingers curled down)
      if (thumb.y < index.y && thumb.y < middle.y && thumb.y < ring.y && thumb.y < pinky.y) {
        return "thumbs up";
      }

      // Detecting hand with fingers spread (all fingers apart)
      if (
        Math.abs(index.x - middle.x) > 0.05 && Math.abs(index.x - ring.x) > 0.05 && Math.abs(index.x - pinky.x) > 0.05 &&
        Math.abs(middle.x - ring.x) > 0.05 && Math.abs(middle.x - pinky.x) > 0.05 && Math.abs(ring.x - pinky.x) > 0.05
      ) {
        return "hand";
      }

      return null;
    }

    // Function to handle the results from MediaPipe and update the translation output
    function onResults(results) {
      canvasCtx.save();
      canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
      canvasCtx.drawImage(results.image, 0, 0, canvasElement.width, canvasElement.height);

      if (results.multiHandLandmarks) {
        for (const landmarks of results.multiHandLandmarks) {
          drawConnectors(canvasCtx, landmarks, HAND_CONNECTIONS, { color: '#00FF00', lineWidth: 5 });
          drawLandmarks(canvasCtx, landmarks, { color: '#FF0000', lineWidth: 2 });
          const gesture = detectGesture(landmarks);
          // Update the translation box based on the detected gesture
          if (gesture === "peace") {
            translationOutput.textContent = "âœŒï¸ Peace Sign";
          } else if (gesture === "thumbs up") {
            translationOutput.textContent = "ðŸ‘ Thumbs Up";
          } else if (gesture === "hand") {
            translationOutput.textContent = "ðŸ– Hand";
          } else {
            translationOutput.textContent = "Translation";
          }
        }
      } else {
        translationOutput.textContent = "Translation";
      }

      canvasCtx.restore();
    }

    // Initialize MediaPipe Hands and camera
    const hands = new Hands({
      locateFile: file => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`
    });
    hands.setOptions({
      maxNumHands: 12,  // Set to 2 for detecting two hands simultaneously
      modelComplexity: 1,
      minDetectionConfidence: 0.5,
      minTrackingConfidence: 0.5
    });
    hands.onResults(onResults);

    async function startCamera(facingMode = 'environment') {
      const stream = await navigator.mediaDevices.getUserMedia({
        video: { facingMode }
      });

      videoElement.srcObject = stream;

      const camera = new Camera(videoElement, {
        onFrame: async () => {
          await hands.send({ image: videoElement });
        },
        width: 640,
        height: 480
      });

      camera.start();
    }

    videoElement.addEventListener('loadedmetadata', () => {
      canvasElement.width = videoElement.videoWidth;
      canvasElement.height = videoElement.videoHeight;
    });

    startCamera();  // Start with back camera only
  </script>
</body>
</html>
